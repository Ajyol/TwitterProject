<%- include('header-footer/header') %>

<h2>Welcome, <%= user.username %>!</h2>

<!-- Create Topic Form -->
<form action="/api/topics" method="POST">
  <input type="text" name="title" placeholder="New Topic Title" required />
  <button type="submit">Create Topic</button>
</form>

<h3>All Topics</h3>
<ul>
  <% topics.forEach(topic => { %>
    <li>
      <strong><%= topic.title %></strong>
      <em>by <%= topic.createdBy.username %></em>

      <% if (topic.subscribers.includes(user._id.toString())) { %>
        <!-- User is already subscribed -->
        <form action="/api/topics/<%= topic._id %>/unsubscribe" method="POST" style="display:inline">
          <button type="submit">Unsubscribe</button>
        </form>
      <% } else { %>
        <!-- User is not subscribed -->
        <form action="/api/topics/<%= topic._id %>/subscribe" method="POST" style="display:inline">
          <button type="submit">Subscribe</button>
        </form>
      <% } %>

      <a href="/topics/<%= topic._id %>/messages">View Messages</a>
    </li>
  <% }) %>
</ul>

<!-- Pagination -->
<div>
  <% if (currentPage > 1) { %>
    <a href="/dashboard?page=<%= currentPage - 1 %>">Previous</a>
  <% } %>
  Page <%= currentPage %> of <%= totalPages %>
  <% if (currentPage < totalPages) { %>
    <a href="/dashboard?page=<%= currentPage + 1 %>">Next</a>
  <% } %>
</div>

<%- include('header-footer/footer') %>
