<%- include('header-footer/header') %>

<!-- Welcome Message -->
<h2 class="welcome-message">Welcome, <%= user.username %>!</h2>

<!-- Create Topic Form -->
<div class="form-container">
  <form action="/api/topics" method="POST" class="create-topic-form">
    <input type="text" name="title" placeholder="New Topic Title" required class="input-field"/>
    <button type="submit" class="submit-btn">Create Topic</button>
  </form>
</div>

<h3 class="topics-header">All Topics</h3>

<!-- List of Topics -->
<ul class="topics-list">
  <% topics.forEach(topic => { %>
    <li class="topic-item">
      <strong class="topic-title"><%= topic.title %></strong>
      <em class="topic-author">by <%= topic.createdBy.username %></em>
      <span class="topic-views">👁️ <%= topic.views || 0 %> views</span>

    <% if (topic.isSubscribed) { %>
      <form action="/api/topics/<%= topic._id %>/unsubscribe" method="POST">
          <button type="submit" class="unsubscribe-btn">Unsubscribe</button>
      </form>
    <% } else { %>
      <form action="/api/topics/<%= topic._id %>/subscribe" method="POST">
          <button type="submit" class="subscribe-btn">Subscribe</button>
      </form>
    <% } %>


      <a href="/topics/<%= topic._id %>/messages" class="view-messages-link">View Messages</a>
    </li>
  <% }) %>
</ul>

<!-- Pagination -->
<div class="pagination">
  <% if (currentPage > 1) { %>
    <a href="/dashboard?page=<%= currentPage - 1 %>" class="pagination-btn">Previous</a>
  <% } %>
  <span class="page-info">Page <%= currentPage %> of <%= totalPages %></span>
  <% if (currentPage < totalPages) { %>
    <a href="/dashboard?page=<%= currentPage + 1 %>" class="pagination-btn">Next</a>
  <% } %>
</div>

<%- include('header-footer/footer') %>
